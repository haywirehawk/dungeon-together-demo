[gd_scene load_steps=9 format=3 uid="uid://dyqvt2u0d20he"]

[ext_resource type="PackedScene" uid="uid://dklgqdynioec2" path="res://scenes/entities/enemy/enemy.tscn" id="1_6bvyx"]
[ext_resource type="Texture2D" uid="uid://ci42daclhvmu0" path="res://assets/tilesets/monochrome-transparent.png" id="2_6bvyx"]
[ext_resource type="Script" uid="uid://wk1wncm8awk7" path="res://scenes/entities/enemy/floating_enemies/floating_enemies.gd" id="2_jch5g"]

[sub_resource type="Shader" id="Shader_6bvyx"]
resource_local_to_scene = true
code = "shader_type canvas_item;

uniform float percent : hint_range(0.0, 1.0, 0.1);
uniform vec4 outline_color : source_color;
uniform vec4 modulate_color: source_color = vec4(1.0);

void fragment(){
	float size_x = 1.0/float(textureSize(TEXTURE, 0).x);
	float size_y = 1.0/float(textureSize(TEXTURE, 0).y);
	vec4 sprite_color = texture(TEXTURE, UV) * modulate_color;
	float alpha = -8.0 * sprite_color.a;
	alpha += texture(TEXTURE, UV + vec2(size_x, 0)).a;
	alpha += texture(TEXTURE, UV + vec2(-size_x, 0)).a;
	alpha += texture(TEXTURE, UV + vec2(0, size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(0, -size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(size_x, size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(-size_x, size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(-size_x, -size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(size_x, -size_y)).a;
	vec4 final_color = mix(sprite_color, outline_color, clamp(alpha, 0.0, 1.0));
	vec4 outlined_texture = vec4(final_color.rgb, clamp(abs(alpha) + sprite_color.a, 0.0, 1.0));
	vec4 white_color = vec4(1.0, 1.0, 1.0, outlined_texture.a);
	COLOR = mix(outlined_texture, white_color, percent);
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_jch5g"]
resource_local_to_scene = true
shader = SubResource("Shader_6bvyx")
shader_parameter/percent = 0.0
shader_parameter/outline_color = Color(0, 0, 0, 1)
shader_parameter/modulate_color = Color(1, 0.24, 0.24, 1)

[sub_resource type="Shader" id="Shader_76ggv"]
resource_local_to_scene = true
code = "shader_type canvas_item;

uniform float percent : hint_range(0.0, 1.0, 0.1);
uniform vec4 outline_color : source_color;
uniform vec4 modulate_color: source_color = vec4(1.0);

void fragment(){
	float size_x = 1.0/float(textureSize(TEXTURE, 0).x);
	float size_y = 1.0/float(textureSize(TEXTURE, 0).y);
	vec4 sprite_color = texture(TEXTURE, UV) * modulate_color;
	float alpha = -8.0 * sprite_color.a;
	alpha += texture(TEXTURE, UV + vec2(size_x, 0)).a;
	alpha += texture(TEXTURE, UV + vec2(-size_x, 0)).a;
	alpha += texture(TEXTURE, UV + vec2(0, size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(0, -size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(size_x, size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(-size_x, size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(-size_x, -size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(size_x, -size_y)).a;
	vec4 final_color = mix(sprite_color, outline_color, clamp(alpha, 0.0, 1.0));
	vec4 outlined_texture = vec4(final_color.rgb, clamp(abs(alpha) + sprite_color.a, 0.0, 1.0));
	vec4 white_color = vec4(1.0, 1.0, 1.0, outlined_texture.a);
	COLOR = mix(outlined_texture, white_color, percent);
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ilesx"]
resource_local_to_scene = true
shader = SubResource("Shader_76ggv")
shader_parameter/percent = 0.0
shader_parameter/outline_color = Color(0, 0, 0, 1)
shader_parameter/modulate_color = Color(1, 1, 1, 1)

[sub_resource type="AtlasTexture" id="AtlasTexture_jch5g"]
atlas = ExtResource("2_6bvyx")
region = Rect2(442, 136, 16, 16)

[node name="FloatingEnemy" instance=ExtResource("1_6bvyx")]
script = ExtResource("2_jch5g")

[node name="AlertSprite" parent="." index="7"]
material = SubResource("ShaderMaterial_jch5g")

[node name="HitFlashSpriteComponent" parent="Visuals" index="0"]
material = SubResource("ShaderMaterial_ilesx")
texture = SubResource("AtlasTexture_jch5g")
