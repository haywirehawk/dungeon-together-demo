[gd_scene load_steps=12 format=3 uid="uid://bf5ooyi0qb45o"]

[ext_resource type="PackedScene" uid="uid://dyqvt2u0d20he" path="res://scenes/entities/enemy/floating_enemies/floating_enemy.tscn" id="1_m1w00"]
[ext_resource type="Script" uid="uid://dcwegw18agdmt" path="res://scenes/entities/enemy/floating_enemies/bat/bat.gd" id="2_tpxc0"]
[ext_resource type="AudioStream" uid="uid://1hmbycmqghia" path="res://assets/audio/hit_1.wav" id="3_u0lyw"]
[ext_resource type="AudioStream" uid="uid://doae36omumbj3" path="res://assets/audio/hit_2.wav" id="4_ifkjn"]
[ext_resource type="AudioStream" uid="uid://c1hykljgaxcbi" path="res://assets/audio/hit_3.wav" id="5_e1nxe"]
[ext_resource type="AudioStream" uid="uid://cealdtp227qx" path="res://assets/audio/hit_4.wav" id="6_t4cps"]

[sub_resource type="AudioStreamRandomizer" id="AudioStreamRandomizer_4oa0t"]
random_pitch = 1.1
random_volume_offset_db = 1.0
streams_count = 4
stream_0/stream = ExtResource("3_u0lyw")
stream_1/stream = ExtResource("4_ifkjn")
stream_2/stream = ExtResource("5_e1nxe")
stream_3/stream = ExtResource("6_t4cps")

[sub_resource type="Shader" id="Shader_tpxc0"]
resource_local_to_scene = true
code = "shader_type canvas_item;

uniform float percent : hint_range(0.0, 1.0, 0.1);
uniform vec4 outline_color : source_color;
uniform vec4 modulate_color: source_color = vec4(1.0);

void fragment(){
	float size_x = 1.0/float(textureSize(TEXTURE, 0).x);
	float size_y = 1.0/float(textureSize(TEXTURE, 0).y);
	vec4 sprite_color = texture(TEXTURE, UV) * modulate_color;
	float alpha = -8.0 * sprite_color.a;
	alpha += texture(TEXTURE, UV + vec2(size_x, 0)).a;
	alpha += texture(TEXTURE, UV + vec2(-size_x, 0)).a;
	alpha += texture(TEXTURE, UV + vec2(0, size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(0, -size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(size_x, size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(-size_x, size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(-size_x, -size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(size_x, -size_y)).a;
	vec4 final_color = mix(sprite_color, outline_color, clamp(alpha, 0.0, 1.0));
	vec4 outlined_texture = vec4(final_color.rgb, clamp(abs(alpha) + sprite_color.a, 0.0, 1.0));
	vec4 white_color = vec4(1.0, 1.0, 1.0, outlined_texture.a);
	COLOR = mix(outlined_texture, white_color, percent);
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_oy641"]
resource_local_to_scene = true
shader = SubResource("Shader_tpxc0")
shader_parameter/percent = 0.0
shader_parameter/outline_color = Color(0, 0, 0, 1)
shader_parameter/modulate_color = Color(1, 0.24, 0.24, 1)

[sub_resource type="Shader" id="Shader_h5aok"]
resource_local_to_scene = true
code = "shader_type canvas_item;

uniform float percent : hint_range(0.0, 1.0, 0.1);
uniform vec4 outline_color : source_color;
uniform vec4 modulate_color: source_color = vec4(1.0);

void fragment(){
	float size_x = 1.0/float(textureSize(TEXTURE, 0).x);
	float size_y = 1.0/float(textureSize(TEXTURE, 0).y);
	vec4 sprite_color = texture(TEXTURE, UV) * modulate_color;
	float alpha = -8.0 * sprite_color.a;
	alpha += texture(TEXTURE, UV + vec2(size_x, 0)).a;
	alpha += texture(TEXTURE, UV + vec2(-size_x, 0)).a;
	alpha += texture(TEXTURE, UV + vec2(0, size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(0, -size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(size_x, size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(-size_x, size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(-size_x, -size_y)).a;
	alpha += texture(TEXTURE, UV + vec2(size_x, -size_y)).a;
	vec4 final_color = mix(sprite_color, outline_color, clamp(alpha, 0.0, 1.0));
	vec4 outlined_texture = vec4(final_color.rgb, clamp(abs(alpha) + sprite_color.a, 0.0, 1.0));
	vec4 white_color = vec4(1.0, 1.0, 1.0, outlined_texture.a);
	COLOR = mix(outlined_texture, white_color, percent);
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_lo2qn"]
resource_local_to_scene = true
shader = SubResource("Shader_h5aok")
shader_parameter/percent = 0.0
shader_parameter/outline_color = Color(0, 0, 0, 1)
shader_parameter/modulate_color = Color(0.278431, 0.176471, 0.235294, 1)

[node name="Bat" instance=ExtResource("1_m1w00")]
script = ExtResource("2_tpxc0")
movement_damping = 2.0
move_speed = 60.0
dash_attack_speed = 360.0
target_distance = 90.0

[node name="HitStreamPlayer2D" type="AudioStreamPlayer2D" parent="." index="5"]
stream = SubResource("AudioStreamRandomizer_4oa0t")
volume_db = -1.0
max_polyphony = 3
bus = &"SFX"

[node name="AlertSprite" parent="." index="8"]
material = SubResource("ShaderMaterial_oy641")

[node name="HitFlashSpriteComponent" parent="Visuals" index="0"]
material = SubResource("ShaderMaterial_lo2qn")
